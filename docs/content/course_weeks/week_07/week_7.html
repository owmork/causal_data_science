<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.536">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>CAUSAL DATA SCIENCE FOR BUSINESS ANALYTICS - 7 - Unobserved Confounding &amp; Instrumental Variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../content/course_weeks/week_08/week_8.html" rel="next">
<link href="../../../content/course_weeks/week_06/week_6.html" rel="prev">
<link href="../../../images/favicon_cds_16x16.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script src="../../../site_libs/quarto-contrib/iconify-1.0.7/iconify-icon.min.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../../styles.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/icon_cds.svg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title"><b>CAUSAL DATA SCIENCE FOR BUSINESS ANALYTICS</b></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../content/course_weeks/overview.html" aria-current="page"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../content/organization/mattermost.html"> 
<span class="menu-text">Organization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://communicating.tuhh.de/w-11-students/channels/cdsba_ss24"> 
<span class="menu-text"><iconify-icon inline="" icon="cib:mattermost" style="font-size: 1.25em;"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../content/course_weeks/week_01/week_1.html"><b>Weekly content</b></a></li><li class="breadcrumb-item"><a href="../../../content/course_weeks/week_07/week_7.html">7 - Unobserved Confounding &amp; Instrumental Variables</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text"><b>Weekly content</b></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_01/week_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 - Introduction to Causal Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_02/week_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 - Graphical Causal Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_03/week_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 - Randomized Experiments &amp; Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_04/week_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 - Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_05/week_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 - Double Machine Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_06/week_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 - Effect Heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_07/week_7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">7 - Unobserved Confounding &amp; Instrumental Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_08/week_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 - Recap from week 5, 6, 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_09/week_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9 - Difference-in-Differences (1/2)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_10/week_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 - Difference-in-Differences (2/2)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_11/week_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 - Synthetic Control (1/2)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/course_weeks/week_12/week_12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 - Synthetic Control (2/2)</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text"><b>Optional reads</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/optional_read/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motivation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/optional_read/prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability Theory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/optional_read/stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Concepts</span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#slides-recap" id="toc-slides-recap" class="nav-link active" data-scroll-target="#slides-recap">Slides &amp; Recap</a></li>
  <li><a href="#parametric-identification-of-ate" id="toc-parametric-identification-of-ate" class="nav-link" data-scroll-target="#parametric-identification-of-ate">Parametric identification of ATE</a></li>
  <li><a href="#sls-two-stage-least-squares" id="toc-sls-two-stage-least-squares" class="nav-link" data-scroll-target="#sls-two-stage-least-squares">2SLS (Two-stage least squares)</a></li>
  <li>
<a href="#nonparametric-identification-of-local-ate" id="toc-nonparametric-identification-of-local-ate" class="nav-link" data-scroll-target="#nonparametric-identification-of-local-ate">Nonparametric identification of Local ATE</a>
  <ul class="collapse">
<li><a href="#principal-stratification" id="toc-principal-stratification" class="nav-link" data-scroll-target="#principal-stratification">Principal stratification</a></li>
  <li><a href="#local-ate" id="toc-local-ate" class="nav-link" data-scroll-target="#local-ate">Local ATE</a></li>
  </ul>
</li>
  <li><a href="#identification-examples" id="toc-identification-examples" class="nav-link" data-scroll-target="#identification-examples">Identification examples</a></li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment">Assignment</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../content/course_weeks/week_01/week_1.html"><b>Weekly content</b></a></li><li class="breadcrumb-item"><a href="../../../content/course_weeks/week_07/week_7.html">7 - Unobserved Confounding &amp; Instrumental Variables</a></li></ol></nav><div class="quarto-title">
<h1 class="title">7 - Unobserved Confounding &amp; Instrumental Variables</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="slides-recap" class="level2"><h2 class="anchored" data-anchor-id="slides-recap">Slides &amp; Recap</h2>
<iframe style="width: 100%; height: 45vw; max-height: 50vh;" frameborder="0" allowfullscreen="" src="https://tuhhstartupengineers-classroom.github.io/ss24-causal-data-science/slides/07_unob_conf.html">
</iframe>
<p><a href="dag_assumptions.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="dag_assumptions.png" class="img-fluid"></a></p>
<p><strong>Assumptions:</strong></p>
<ol type="1">
<li>
<strong>Relevance</strong>: <span class="math inline">\(Z\)</span> is significantly correlated with <span class="math inline">\(T\)</span>, i.e.&nbsp;<span class="math inline">\(Cov(Z, T) \neq 0\)</span>. <span style="color:#00C1D4">Path 1</span> must exist.</li>
<li>
<strong>Exclusion Restriction</strong>: <span class="math inline">\(Z\)</span> affects <span class="math inline">\(Y\)</span> only through <span class="math inline">\(T\)</span>. A direct <span style="color:#FF7E15">path 2</span> must <strong>not</strong> exist.</li>
<li>
<strong>Unconfoundedness</strong> (Exogeneity, Validity): <span class="math inline">\(Z\)</span> is independent of <span class="math inline">\(U\)</span>, i.e.&nbsp;<span class="math inline">\(Cov(Z, \epsilon_Y) = 0\)</span>. Conditioning on <span class="math inline">\(\mathbf{X}\)</span> required in some contexts (will cover this later). <span style="color:#FF7E15">Path 3</span> must <strong>not</strong> exist.</li>
</ol>
<p>For our practical example, imagine the following situation: you have developed an app and you are already having an active user base. Of course, some users are more active than other users. Also, users might use the app for different purposes. In general, user behavior likely depends on a lot of unobserved characteristics.</p>
<p>Obviously, your goal is to keep users as long as possible on the app to maximize your ad revenues. To do that, you want to introduce a new feature and see how it affects time spent on the app. Simply comparing users who use the newly introduced feature to users who don’t would result in a biased estimate due to the unobserved confounders regarding their activity and willingness to use a new feature.</p>
<p>Therefore, you perform a so called randomized encouragement trial, where for a random selection of users, a popup appears when opening the app and encourages these users to test new feature. The users who are not randomly selected don’t get a popup message but could also use the new feature.</p>
<p>After a while you collect data on users’ activity and also if they were encouraged and if they used the new feature. <a href="https://cloud.tuhh.de/index.php/s/MifsryCfsqRXG3B">Download</a> the data and load it.</p>
<ul>
<li>
<strong>Causal Effect:</strong> The impact of a new feature on the time spent in the app.</li>
<li>
<strong>Treatment:</strong> Usage of the new feature.</li>
<li>
<strong>Outcome:</strong> Time spent in the app.</li>
<li>
<strong>Instrument:</strong> Randomized encouragement (e.g., a popup message encouraging users to try the new feature).</li>
</ul>
<p>This setup avoids running an A/B test on the feature itself by using an encouragement design, which is often more acceptable from a business perspective, particularly when there is a desire to roll out a feature to all users.</p>
<div class="cell" data-layout-align="center" data-warnings="false">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load tidyverse</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'ggplot2' wurde unter R Version 4.3.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'tidyr' wurde unter R Version 4.3.2 erstellt</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load data and print</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"rand_enc.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 3
   popup used_ftr time_spent
   &lt;int&gt;    &lt;int&gt;      &lt;dbl&gt;
 1     0        0       65.5
 2     0        0       77.5
 3     1        0       70.8
 4     0        0       58.5
 5     0        1       86.1
 6     1        1       67.7
 7     0        0       68.1
 8     0        0       63.3
 9     1        1       69.2
10     0        0       60.9
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p><span style="color:#FF7E15"><strong>Task 1:</strong></span> Evaluate the IV assumptions.</p>
<details><summary><span style="color:#00C1D4"><strong>Relevance</strong></span>
</summary><ul>
<li>
<em>Question:</em> Does the randomized encouragement (popup message) affect the likelihood of using the new feature?</li>
<li>
<em>Evaluation:</em> It is plausible that the encouragement message will increase the probability that users try the new feature, satisfying the relevance condition.</li>
</ul></details><details><summary><span style="color:#00C1D4"><strong>Exclusion Restriction</strong></span>
</summary><ul>
<li>
<em>Question:</em> Does the randomized encouragement affect the time spent in the app only through its effect on the usage of the new feature?</li>
<li>
<em>Evaluation:</em> Assuming the only reason the encouragement affects the time spent in the app is by increasing the use of the new feature, this condition holds. The popup message should not directly affect time spent in the app other than by leading users to use the new feature.</li>
</ul></details><details><summary><span style="color:#00C1D4"><strong>Unconfoundedness</strong></span>
</summary><ul>
<li>
<em>Question:</em> Is the random assignment of encouragement independent of potential outcomes and treatments?</li>
<li>
<em>Evaluation:</em> Since the encouragement is randomized, it should be independent of other factors that could influence both the usage of the new feature and the time spent in the app, satisfying this condition.</li>
</ul></details></section><section id="parametric-identification-of-ate" class="level2"><h2 class="anchored" data-anchor-id="parametric-identification-of-ate">Parametric identification of ATE</h2>
<p>As in our practical example, we will derive the ATE for the binary case, i.e.&nbsp;a binary instrument and a binary treatment variable. However, the continuous case is very similar. For the parametric identification, we assume linearity. In other words, we assume a homogeneous treatment effect and exclude effect heterogeneity with regard to unobserved variables.</p>
<p><span class="math display">\[
Y_i = \beta_0 + \tau T_i + \beta_U U_i + \epsilon_i
\]</span> Please note, that there is no <span class="math inline">\(Z\)</span> in this formula due to the exclusion restriction.</p>
<p>Let’s go through the identification procedure step by step. You will see and use the other assumptions there, as well.</p>
<p>We start with the associational difference for <span class="math inline">\(Y\)</span> under different values for <span class="math inline">\(Z\)</span>. It’s not the treatment effect <span class="math inline">\(\tau\)</span>, but because we can observe this expression, we take it as a starting point.</p>
<p><span class="math display">\[
\begin{align*}
&amp; \mathbb{E}[Y_i | Z_i = 1] - \mathbb{E}[Y_i | Z_i = 0] \\
\end{align*}
\]</span></p>
<details><summary><strong>Explanation</strong>
</summary><p>Assumption of linearity.</p>
</details><p><span class="math display">\[
\begin{align*}
&amp;= \mathbb{E}[\beta_0 + \tau T_i + \beta_U U_i + \epsilon_i | Z_i = 1] - \mathbb{E}[\beta_0 + \tau T_i + \beta_U U_i + \epsilon_i | Z_i = 0] \\
\end{align*}
\]</span></p>
<details><summary><strong>Explanation</strong>
</summary><p>Linearity of expectation.</p>
</details><p><span class="math display">\[
\begin{align*}
&amp;= \beta_0 + \tau \mathbb{E}[T_i | Z_i = 1] + \beta_u \mathbb{E}[U_i | Z_i = 1] + \mathbb{E}[\epsilon_i | Z_i = 1] - \beta_0 - \tau \mathbb{E}[T_i | Z_i = 0] - \beta_u \mathbb{E}[U_i | Z_i = 0] - \mathbb{E}[\epsilon_i | Z_i = 0] \\
\end{align*}
\]</span></p>
<details><summary><strong>Explanation</strong>
</summary><p>Re-arranging, removing <span class="math inline">\(\epsilon_i\)</span> and <span class="math inline">\(\beta_0\)</span>.</p>
</details><p><span class="math display">\[
\begin{align*}
&amp;= \tau (\mathbb{E}[T_i | Z_i = 1] - \mathbb{E}[T_i | Z_i = 0]) + \beta_u (\mathbb{E}[U_i | Z_i = 1] - \mathbb{E}[U_i | Z_i = 0]) \\
\end{align*}
\]</span></p>
<details><summary><strong>Explanation</strong>
</summary><p>Unconfoundedness assumption.</p>
</details><p><span class="math display">\[
\begin{align*}
&amp;= \tau (\mathbb{E}[T_i | Z_i = 1] - \mathbb{E}[T_i | Z_i = 0]) + \beta_u (\mathbb{E}[U_i] - \mathbb{E}[U_i]) \\
\end{align*}
\]</span></p>
<details><summary><strong>Explanation</strong>
</summary><p>Re-arranging/removing terms.</p>
</details><p><span class="math display">\[
\begin{align*}
&amp;= \tau (\mathbb{E}[T_i | Z_i = 1] - \mathbb{E}[T_i | Z_i = 0])
\end{align*}
\]</span></p>
<p><span style="color:#FF7E15"><strong>Task 2:</strong></span> Solve for <span class="math inline">\(\tau\)</span> and compute sample version of the Wald estimand.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Numerator</span></span>
<span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">popup</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">time_spent</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">popup</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">$</span><span class="va">time_spent</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Denominator</span></span>
<span><span class="va">den</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">popup</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">used_ftr</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">popup</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">$</span><span class="va">used_ftr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wald estimate</span></span>
<span><span class="va">num</span><span class="op">/</span><span class="va">den</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.3</code></pre>
</div>
</div>
<!-- *Question:* In which case is the denominator zero and we cannot identify the estimate? What assumption is violated? -->
</section><section id="sls-two-stage-least-squares" class="level2"><h2 class="anchored" data-anchor-id="sls-two-stage-least-squares">2SLS (Two-stage least squares)</h2>
<p>A more practical way of estimating the treatment effect is the two-stage least squares estimator (2SLS) which returns an estimate equivalent to the one just computed. 2SLS splits the estimation procedure in two stages:</p>
<ul>
<li>1st stage: regress <span class="math inline">\(T\)</span> on <span class="math inline">\(Z\)</span> to obtain <span class="math inline">\(\hat{T}\)</span>, where <span class="math inline">\(\hat{T}\)</span> are the fitted values.</li>
<li>2nd stage: regress <span class="math inline">\(Y\)</span> on <span class="math inline">\(\hat{T}\)</span> to obtain the coefficient <span class="math inline">\(\hat{\tau}\)</span>, which is the treatment effect.</li>
</ul>
<p>In the graphs below, you can see how the 2SLS estimator works. First, <span class="math inline">\(U\)</span> is an unobserved confounder of <span class="math inline">\(T\)</span> on <span class="math inline">\(Y\)</span>. When replacing <span class="math inline">\(T\)</span> with <span class="math inline">\(\hat{T}\)</span>, there is no arrow from <span class="math inline">\(U\)</span> on the adjusted treatment, because there is no dependence.</p>
<p><img src="dag_IV_2sls_1.png" width="425"><img height="350" hspace="20"><img src="dag_IV_2sls_2.png" width="425"></p>
<p><span style="color:#FF7E15"><strong>Task 3:</strong></span> Compute the treatment effect using the 2SLS estimator as described. (1) First, do it by running the two regressions. (2) Then, use the <code>R</code> package <code>AER</code> and the function <code><a href="https://rdrr.io/pkg/AER/man/ivreg.html">ivreg()</a></code>. The syntax for the formula is: <code>Y ~ T | Z</code>. (Note: for method (1) your standard errors will be wrong. You can ignore that for now.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># (a) with wrong standard errors</span></span>
<span></span>
<span><span class="co"># First stage</span></span>
<span><span class="va">stage_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">used_ftr</span> <span class="op">~</span> <span class="va">popup</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">stage_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = used_ftr ~ popup, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-0.659 -0.309 -0.309  0.341  0.691 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.30941    0.00667    46.4   &lt;2e-16 ***
popup        0.35002    0.00937    37.4   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.47 on 9998 degrees of freedom
Multiple R-squared:  0.123, Adjusted R-squared:  0.122 
F-statistic: 1.4e+03 on 1 and 9998 DF,  p-value: &lt;2e-16</code></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Second stage</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">used_ftr_hat</span> <span class="op">&lt;-</span> <span class="va">stage_1</span><span class="op">$</span><span class="va">fitted.values</span></span>
<span><span class="va">stage_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">time_spent</span> <span class="op">~</span> <span class="va">used_ftr_hat</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">stage_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = time_spent ~ used_ftr_hat, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-41.66  -7.36   0.28   7.87  31.94 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    62.273      0.322   193.2   &lt;2e-16 ***
used_ftr_hat    9.309      0.623    14.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11 on 9998 degrees of freedom
Multiple R-squared:  0.0218,    Adjusted R-squared:  0.0217 
F-statistic:  223 on 1 and 9998 DF,  p-value: &lt;2e-16</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"AER"</span><span class="op">)</span> <span class="co"># (Applied Economics with R)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-warnings="false">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># (b) with correct standard errors</span></span>
<span></span>
<span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AER</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'AER' wurde unter R Version 4.3.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'survival' wurde unter R Version 4.3.3 erstellt</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Two-stage least squares</span></span>
<span><span class="va">tsls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AER/man/ivreg.html">ivreg</a></span><span class="op">(</span><span class="va">time_spent</span> <span class="op">~</span> <span class="va">used_ftr</span> <span class="op">|</span> <span class="va">popup</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tsls</span>, vcov <span class="op">=</span> <span class="va">vcovHC</span><span class="op">)</span> <span class="co"># with robust standard errors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = time_spent ~ used_ftr | popup, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-35.52  -6.03   0.62   6.63  27.28 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   62.273      0.270   230.5   &lt;2e-16 ***
used_ftr       9.309      0.524    17.8   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.2 on 9998 degrees of freedom
Multiple R-Squared: 0.308,  Adjusted R-squared: 0.308 
Wald test:  316 on 1 and 9998 DF,  p-value: &lt;2e-16 </code></pre>
</div>
</div>
</section><section id="nonparametric-identification-of-local-ate" class="level2"><h2 class="anchored" data-anchor-id="nonparametric-identification-of-local-ate">Nonparametric identification of Local ATE</h2>
<p>The linearity assumption is a very strong parametric assumption, as it e.g.&nbsp;requires homogeneous treatment effects. Therefore, we would like to nonparametrically identify the treatment effect, and in fact, we can. However, we are not able to identify the average treatment effect ATE, but instead a local version of the average treatment effect, known as LATE. While we can drop the linearity assumption, now the assumption of monotonicity is needed. But first, we have to introduce a bit of new notation to express the relationship between instrument and treatment. The notation is similar to the potential outcome notation.</p>
<section id="principal-stratification" class="level3"><h3 class="anchored" data-anchor-id="principal-stratification">Principal stratification</h3>
<p>We segment population into four segments. E.g. <span class="math inline">\(T_i(Z = 1) = 1\)</span> represents unit’s <span class="math inline">\(i\)</span> decision to “get the treatment” when being encouraged. Based on all possible combinations, four different exist:</p>
<ul>
<li>
<code>Compliers</code> always take the treatment that they’re encouraged to take: <span class="math inline">\(T_i(1) = 1\)</span> and <span class="math inline">\(T_i(0) = 0\)</span>.</li>
<li>
<code>Always-Takers</code> always take the treatment, regardless of encouragement: <span class="math inline">\(T_i(1) = 1\)</span> and <span class="math inline">\(T_i(0) = 1\)</span>.</li>
<li>
<code>Never-Takers</code> never take the treatment, regardless of encouragement: <span class="math inline">\(T_i(1) = 0\)</span> and <span class="math inline">\(T_i(0) = 0\)</span>.</li>
<li>
<code>Defiers</code> always take the opposite treatment that they’re encouraged to take: <span class="math inline">\(T_i(1) = 0\)</span> and <span class="math inline">\(T_i(0) = 1\)</span>.</li>
</ul>
<p>Applied to our example, usere who receive the encouragement (popup message) and use it are compliers.</p>
<p><span style="color:#FF7E15"><strong>Task 4:</strong></span> We are not able to observe whether a unit is a complier, always-taker, never-taker or defier. For each observed combination of <span class="math inline">\(Z\)</span> and <span class="math inline">\(T\)</span>, there are always two options. For the following combinations, answer what segments could be possible.</p>
<details><summary><span style="color:#FFFFFF"><span class="math inline">\(Z=0, T=0\)</span></span>
</summary><p>Compliers or never-takers</p>
</details><details><summary><span style="color:#FFFFFF"><span class="math inline">\(Z=0, T=1\)</span></span>
</summary><p>Defiers or always-takers</p>
</details><details><summary><span style="color:#FFFFFF"><span class="math inline">\(Z=1, T=0\)</span></span>
</summary><p>Defiers or never-takers</p>
</details><details><summary><span style="color:#FFFFFF"><span class="math inline">\(Z=1, T=1\)</span></span>
</summary><p>Compliers or always-takers</p>
</details><p><span style="color:#FF7E15"><strong>Task 5:</strong></span> <a href="https://dagitty.net/dags.html#">Draw the DAGs</a> for complier and never-takers.</p>
</section><section id="local-ate" class="level3"><h3 class="anchored" data-anchor-id="local-ate">Local ATE</h3>
<p>In case of unobserved confounding, we will nonparametrically identify the local average treatment effect (LATE), also known as the complier average causal affect (CACE). It is the average tratment effect among compliers.</p>
<p><span class="math display">\[
\mathbb{E}[Y_i(T_i=1) - Y_i(T_i=0) | T_i(Z_i=1) = 1, T_i(Z_i=0) = 0]
\]</span></p>
<p>Instead of linearity, we assume monotonicity: a unit encouraged to take the treatment (<span class="math inline">\(Z=1\)</span>), is either more or equally likely to take it then without encouragement (<span class="math inline">\(Z=0\)</span>).</p>
<p><span class="math display">\[
T_i(Z_i=1) \geq T_i(Z_i=0) \,\, \forall i
\]</span></p>
<p>The monotonicity assumption implies that there are no defiers because they actually always act differently than the compliers.</p>
<p>In our example, monotonicity means that the popup uniformly increase the likelihood of using the new feature, without making any users less likely to use it. And while the assumption is not testable, we could argue that the popup message is unlikely to decrease the likelihood that users try the new feature. Therefore, this condition is likely satisfied.</p>
<p>For the estimation of the LATE, if <span class="math inline">\(Z_i\)</span> and <span class="math inline">\(T_i\)</span> are binary instrument and treatment variable, respectively, and monotonicity holds, it follows</p>
<p><span class="math display">\[
\mathbb{E}[Y_i(1) - Y_i(0) | T_i(1) = 1, T_i(0) = 0] = \frac{\mathbb{E}[Y_i | Z_i = 1] - \mathbb{E}[Y_i | Z_i = 0]}{\mathbb{E}[T_i | Z_i = 1] - \mathbb{E}[T_i | Z_i = 0]}
\]</span></p>
<p>The numerator term is also called <em>Intention-to-Treat (ITT) Effect</em>, while the denominator is 1st-stage effect or <em>Complier Share</em>.</p>
<p><span style="color:#FF7E15"><strong>Task 6:</strong></span> Compute ITT and complier share for our example. How would the LATE vary with a lower or higher complier share?</p>
</section></section><section id="identification-examples" class="level2"><h2 class="anchored" data-anchor-id="identification-examples">Identification examples</h2>
<p><span style="color:#FF7E15"><strong>Task 7:</strong></span> Finding a good instrument is often times quite difficult due to the requirements discussed above. Read the following identification strategies and evalute their validity.</p>
<div class="grid">
<div class="g-col-9">
<p><strong>Case 1: Effect of R&amp;D Expenditure on Innovation Output</strong></p>
<table class="table">
<thead><tr class="header">
<th>Variable</th>
<th style="text-align: right;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: right;">R&amp;D expenditure</td>
</tr>
<tr class="even">
<td>Outcome</td>
<td style="text-align: right;">Number of patents filed</td>
</tr>
<tr class="odd">
<td>Instrument</td>
<td style="text-align: right;">Firm size</td>
</tr>
</tbody>
</table>
<details><summary><strong>Evaluation</strong>
</summary><p>Firm size affects R&amp;D expenditure (relevance) but also likely directly affects innovation output due to economies of scale and other factors, violating the exclusion restriction. [invalid]</p>
</details><p><strong>Case 2: Effect of Training Programs on Employee Productivity</strong></p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 82%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th style="text-align: right;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: right;">Participation in a training program</td>
</tr>
<tr class="even">
<td>Outcome</td>
<td style="text-align: right;">Employee productivity measured by output per hour</td>
</tr>
<tr class="odd">
<td>Instrument</td>
<td style="text-align: right;">Distance from the employee’s home to the training center</td>
</tr>
</tbody>
</table>
<details><summary><strong>Evaluation</strong>
</summary><p>Distance from home to the training center is likely to influence participation in the training program (relevance) but should not directly affect productivity except through participation in the training program (exclusion restriction). [valid]</p>
</details><p><strong>Case 3: Effect of Marketing Spend on Sales</strong></p>
<table class="table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th style="text-align: right;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: right;">Marketing expenditure by a firm</td>
</tr>
<tr class="even">
<td>Outcome</td>
<td style="text-align: right;">Sales revenue</td>
</tr>
<tr class="odd">
<td>Instrument</td>
<td style="text-align: right;">Introduction of a new marketing budget rule that allocates more funds to marketing based on predefined criteria</td>
</tr>
</tbody>
</table>
<details><summary><strong>Evaluation</strong>
</summary><p>The new budget rule affects marketing expenditure (relevance) and is assumed to affect sales only through changes in marketing expenditure (exclusion restriction). Independence holds if the rule is exogenous to other factors affecting sales. [valid]</p>
</details><p><strong>Case 4: Effect of Employee Benefits on Job Satisfaction</strong></p>
<table class="table">
<thead><tr class="header">
<th>Variable</th>
<th style="text-align: right;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: right;">Generosity of employee benefits</td>
</tr>
<tr class="even">
<td>Outcome</td>
<td style="text-align: right;">Job satisfaction score</td>
</tr>
<tr class="odd">
<td>Instrument</td>
<td style="text-align: right;">Firm’s overall profitability</td>
</tr>
</tbody>
</table>
<details><summary><strong>Evaluation</strong>
</summary><p>Firm profitability may influence the ability to offer generous benefits (relevance), but it also directly affects job satisfaction through other channels like job security and working conditions, violating the exclusion restriction. [invalid]</p>
</details>
</div>
</div>
</section><section id="assignment" class="level2"><h2 class="anchored" data-anchor-id="assignment">Assignment</h2>
<div class="assignment">
<p>Accept the <a href="https://classroom.github.com/a/R80VGxLm">Week 7 - Assignment</a> and follow the same steps as last week and as described in the organization chapter.</p>
<ol type="1">
<li>
<p>Take the example from the tutorial.</p>
<ol type="1">
<li><p>Regress <span class="math inline">\(Y\)</span> on <span class="math inline">\(T\)</span>.</p></li>
<li><p>Regress <span class="math inline">\(Y\)</span> on <span class="math inline">\(Z\)</span>.</p></li>
<li><p>Compare the estimates to the one obtained by instrumental variable regression and argue why the size differs. Why are the two regressions not valid estimates of the treatment effect?</p></li>
</ol>
</li>
<li><p>Compute the different bounds presented in the lecture and for each bound, explain in one sentence, in your own words, what is assumed.</p></li>
<li>
<p>Using the data <code>task_3.rds</code>, perform a sensitivity analysis using the package <code>sensemakr</code> as presented in the lecture. The outcome and treatment is the same as in the tutorial, but you have one additional covariate, <code>age</code>. With the results from the sensitivity analysis, answer the following questions.</p>
<ol type="1">
<li><p>How sensitive is your estimate to a potential unobserved confounder which is 1x, 2x, or 3x as strong as the variable <code>age</code>?</p></li>
<li><p>Interpret the robustness value and explain, in your own words, what it expresses.</p></li>
</ol>
</li>
</ol>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../../content/course_weeks/week_06/week_6.html" class="pagination-link  aria-label=" effect="" heterogeneity="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">6 - Effect Heterogeneity</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../content/course_weeks/week_08/week_8.html" class="pagination-link" aria-label="8 - Recap from week 5, 6, 7">
        <span class="nav-page-text">8 - Recap from week 5, 6, 7</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>lv3095_s24: Causal Data Science for Business Analytics</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","descPosition":"bottom","loop":false,"openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>