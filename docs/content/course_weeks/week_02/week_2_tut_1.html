<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.536">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>CAUSAL DATA SCIENCE FOR BUSINESS ANALYTICS - 2 - Graphical Causal Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon_cds_16x16.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script src="../../../site_libs/quarto-contrib/iconify-1.0.7/iconify-icon.min.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/icon_cds.svg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title"><b>CAUSAL DATA SCIENCE FOR BUSINESS ANALYTICS</b></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../content/course_weeks/overview.html"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../content/organization/mattermost.html"> 
<span class="menu-text">Organization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://communicating.tuhh.de/w-11-students/channels/cdsba_ss24"> 
<span class="menu-text"><iconify-icon inline="" icon="cib:mattermost" style="font-size: 1.25em;"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#slides-recap" id="toc-slides-recap" class="nav-link active" data-scroll-target="#slides-recap">Slides &amp; Recap</a></li>
  <li><a href="#dags" id="toc-dags" class="nav-link" data-scroll-target="#dags">DAGs</a></li>
  <li><a href="#introduction-dagitty-dagitty-in-r" id="toc-introduction-dagitty-dagitty-in-r" class="nav-link" data-scroll-target="#introduction-dagitty-dagitty-in-r">Introduction dagitty, dagitty in R</a></li>
  <li>
<a href="#types-of-association" id="toc-types-of-association" class="nav-link" data-scroll-target="#types-of-association">Types of association</a>
  <ul class="collapse">
<li><a href="#chain" id="toc-chain" class="nav-link" data-scroll-target="#chain">Chain</a></li>
  <li><a href="#fork" id="toc-fork" class="nav-link" data-scroll-target="#fork">Fork</a></li>
  <li><a href="#collision" id="toc-collision" class="nav-link" data-scroll-target="#collision">Collision</a></li>
  <li><a href="#quiz" id="toc-quiz" class="nav-link" data-scroll-target="#quiz">Quiz</a></li>
  </ul>
</li>
  <li>
<a href="#practical-examples" id="toc-practical-examples" class="nav-link" data-scroll-target="#practical-examples">Practical examples</a>
  <ul class="collapse">
<li><a href="#effect-of-hiring-consultants" id="toc-effect-of-hiring-consultants" class="nav-link" data-scroll-target="#effect-of-hiring-consultants">Effect of hiring consultants</a></li>
  <li><a href="#effect-of-new-feature" id="toc-effect-of-new-feature" class="nav-link" data-scroll-target="#effect-of-new-feature">Effect of new feature</a></li>
  </ul>
</li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment">Assignment</a></li>
  <li><a href="#further-optional-reading" id="toc-further-optional-reading" class="nav-link" data-scroll-target="#further-optional-reading">Further optional reading</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">2 - Graphical Causal Models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="slides-recap" class="level2"><h2 class="anchored" data-anchor-id="slides-recap">Slides &amp; Recap</h2>
<p><a href="../../../lecture/02.pdf"><strong>Slides - Week 2</strong></a></p>
<p>In this chapter, we focus on the identification of causal effects with the help of graphical models, also known as <strong>d</strong>irected <strong>a</strong>cyclic <strong>g</strong>raphs (DAGs). By graphically modeling and leveraging your theoretical knowledge about the data-generating process, you will be able to understand when association is actually causation.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Data-generating process (DGP) refers to the underlying mechanisms that generate the data we observe. It represents real-world processes that produce the data points we analyze.</p>
</div>
</div>
<p>DAGs show what variables are important for your analysis and how you think they are related. Information to draw a DAG can come from things like:</p>
<ul>
<li>Domain knowledge</li>
<li>State-of-the art theory</li>
<li>Plausible assumptions and hypotheses</li>
<li>Observations and experiences</li>
<li>Conversations with experts</li>
</ul>
<p>It should map what you know about the phenomena you are studying into a visual representation. By deciding how to draw your graph you have to ask yourself:</p>
<ul>
<li>Between what variables do you think is a causal relationship?</li>
<li>Between what variables there is <strong>no</strong> causal relationship?</li>
</ul></section><section id="dags" class="level2"><h2 class="anchored" data-anchor-id="dags">DAGs</h2>
<p>To discuss and illustrate the notation and terminology of DAGs, we start with a simple and often discussed research problem in causal inference. It deals with the question of whether a university degree increases the salary. While people with university degree tend to earn more than people without university degree, there is the question whether this is caused by the university degree or it is mainly influenced by individuals’ ability. People who are more capable tend to go to university and will be more successful in their later career regardless of the university degree. It is very likely that the truth is that both ability and university degree are factors for future salary, but just to get your assumptions clear and guide you in your research strategy, DAGs are of a great benefit. By the way, it helps to imagine association flowing through a graphical model as water flows through a stream.</p>
<p>Depicted in a graph, we get the following:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Let’s discuss some terms:</p>
<p><strong>Question 1:</strong> What is/are the descendant(s) of <code>ability</code>?</p>
<details><summary>
Answer
</summary><p><code>uni_degree</code> and <code>salary</code></p>
</details><p><strong>Question 2:</strong> What is/are the parent(s) of <code>salary</code>?</p>
<details><summary>
Answer
</summary><p><code>uni_degree</code> and <code>ability</code></p>
</details><p><strong>Question 3:</strong> What is the treatment and what is the outcome?</p>
<details><summary>
Answer
</summary><p><code>uni_degree</code> and <code>salary</code></p>
</details><p><strong>Question 4:</strong> What does a node depict?</p>
<details><summary>
Answer
</summary><p>A random variable</p>
</details><p><strong>Question 5:</strong> What does an arrow depict?</p>
<details><summary>
Answer
</summary><p>Flow of association</p>
</details></section><section id="introduction-dagitty-dagitty-in-r" class="level2"><h2 class="anchored" data-anchor-id="introduction-dagitty-dagitty-in-r">Introduction dagitty, dagitty in R</h2>
<p>Of course, it’s perfectly fine to first sketch DAGs on a sheet of paper, but at some point, when your analysis gets more complex, you are well advised to make use of computational resources. In the following paragraphs, you will be introduced to a few very useful resources.</p>
<p>A well implemented application is <a href="http://dagitty.net/dags.html#">DAGitty</a>, a browser-based environment for creating and analyzing DAGs. Draw your DAG, define treatment and outcome, which variables are observed and unobserved and many other things. Afterwards, you will see what kind of adjustment is necessary to estimate the causal effect of interest. There is also an implementation in R, which is the R package <code>dagitty</code> complemented by <code>ggdag</code>, which provides improved plotting functionality.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Install dagitty package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"dagitty"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install ggdag</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ggdag"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we will cover three different ways to create the DAG shown above.</p>
<p><strong>Option 1: Build on browser-based <a href="http://dagitty.net/dags.html#">DAGitty</a></strong></p>
<p>…</p>
<p><strong>Option 2: Build using R package <code>dagitty</code></strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In several R functions you will find the syntax <code>y ~ x</code> or <code>y ~ x1 + x2 + ...</code> to specify your functional form. It represents <span class="math inline">\(y\)</span> being dependent on <span class="math inline">\(x\)</span> (of course the names depend on your data/model). Please note, that no parentheses are needed.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When drawing the DAG yourself, you can leave out <code>theme_dag_cds()</code> as it is only a custom theme that I have defined for this website. Instead you could use other themes such as <code>theme_dag()</code>, <code>theme_dag_grey()</code>, <code>theme_dag_blank()</code> or proceed without any theme. The other modifications following the theme are also only for the purpose of matching the website theme and can be disregarded. However, you should set <code>text = TRUE</code> in <code>ggdag()</code> in this case.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="co">#...</span></span>
<span></span>
<span><span class="co"># Define dependencies and coordinates</span></span>
<span><span class="co">#...</span></span>
<span></span>
<span><span class="co"># Plot DAG</span></span>
<span><span class="co">#...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Option 3: Copy from dagitty.net to build graph in R</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define DAG</span></span>
<span><span class="co"># ...</span></span>
<span></span>
<span><span class="co"># Plot DAG</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One great advantage of having our DAG coded into R or on DAGitty is the possibility to see what we have to adjust for. You can do that by running the command <code>adjustmentSets()</code> which returns all possible sets of variables that you can control for to retrieve a causal effect.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get adjustment sets. Because we already specified exposure and outcome when</span></span>
<span><span class="co"># constructing the DAG, we do not need to do again. If they were not specified,</span></span>
<span><span class="co"># you could do so by explicitly providing arguments ("exposure", "outcome")</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="types-of-association" class="level2"><h2 class="anchored" data-anchor-id="types-of-association">Types of association</h2>
<p>Most of the time, DAGs are more complex than the example above. Even in that example, there are many more variables that could be included, like social environment, gender etc. But although in practice DAGs are more complex, they can be disassembled in building blocks that are easier to analyze.</p>
<p>Effectively, there are only three different types of association we need to focus on:</p>
<p><strong>Chain:</strong> <span class="math inline">\(X \rightarrow Z \rightarrow Y\)</span></p>
<p><strong>Confounder:</strong> <span class="math inline">\(X \leftarrow Z \rightarrow Y\)</span></p>
<p><strong>Collider:</strong> <span class="math inline">\(X \rightarrow Z \leftarrow Y\)</span></p>
<p>Knowing their characteristics and idiosyncrasies allows us to identify valid strategies to estimate causal effects. Then, you know which variables you have to include in your analysis and which ones you have to leave out. Because in case you include or exclude the wrong variables, you will end up with a biased results and you are not able to interpret your estimate causally.</p>
<p>It is important to understand (conditional) (in-)dependencies between, and with particular focus on conditional independence. An important concept you learned in the lecture is d-separation:</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>d-separation</strong></p>
<p>Two nodes <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are <em>d-separated</em> by a set of nodes <span class="math inline">\(Z\)</span> if all of the paths between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are blocked by <span class="math inline">\(Z\)</span>.</p>
</div>
</div>
<section id="chain" class="level3"><h3 class="anchored" data-anchor-id="chain">Chain</h3>
<p>One element is a chain of random variables where the causal effect flows in one direction.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Specify chain structure</span></span>
<span><span class="va">chain</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">3</span>, Z <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">0</span>, Z <span class="op">=</span> <span class="fl">0</span>, X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot DAG</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">chain</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_dag_cds</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom theme, can be left out</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Consider the following variables:</p>
<ul>
<li>
<span class="math inline">\(X\)</span>: Investment in R&amp;D</li>
<li>
<span class="math inline">\(Z\)</span>: Innovative products</li>
<li>
<span class="math inline">\(Y\)</span>: Market share</li>
</ul>
<p>This mechanism is also sometimes called mediation, because <span class="math inline">\(Z\)</span> mediates the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p>
<p><strong>Question:</strong> Describe the dependencies in the DAG above.</p>
<details><summary>
Answer
</summary><ul>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by the arrow. If you invest more into R&amp;D, you develop more innovative products.</li>
<li>
<span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by the arrow. If you develop more innovative products, your market share increases.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by the arrow (going through <span class="math inline">\(Z\)</span>). More investment in R&amp;D leads to more innovative products and an increased market share.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: independent, because when we condition on innovative products, that means we hold the quantity and quality of innovative products fixed at a particular level, then there is no effect from investment in R&amp;D to market share as there is no direct effect, but only an effect through the development of innovative products.</li>
</ul></details><p><strong>Rule:</strong> <em>Two variables,</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span><em>, are conditionally independent given</em> <span class="math inline">\(Z\)</span><em>, if there is only one unidirectional path between</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span> <em>and</em> <span class="math inline">\(Z\)</span> <em>is any set of variables that intercepts that path.</em></p>
<p>We can also check using the function <code>dseperated()</code>. It returns TRUE when two nodes are d-separated, which means that they are independent of each other. You need to provide <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, which are the focal nodes and <span class="math inline">\(Z\)</span>, your set that you condition on.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y conditional on Z</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="fork" class="level3"><h3 class="anchored" data-anchor-id="fork">Fork</h3>
<p>Another mechanism is the fork, also called common cause.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fork</span></span>
<span><span class="va">fork</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">3</span>, Z <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">0</span>, Z <span class="op">=</span> <span class="fl">1</span>, X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot DAG</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">fork</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_dag_cds</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom theme, can be left out</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>The reason it is called common cause is that, as depicted above, both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are caused by <span class="math inline">\(Z\)</span>.</p>
<p>To illustrate it, consider the following scenario: <span class="math inline">\(Z\)</span> represents the temperature in a particular town and <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> represent ice cream sales and number of crimes in that same town, respectively.</p>
<ul>
<li>
<span class="math inline">\(X\)</span>: ice cream sales</li>
<li>
<span class="math inline">\(Z\)</span>: temperature</li>
<li>
<span class="math inline">\(Y\)</span>: number of crimes</li>
</ul>
<p>Then, you could hypothesize that with increasing temperature people start to eat and buy more ice cream and also more crimes will happen as more people are outside which presents a greater opportunity for crime. Therefore ice cream sales and number of crimes tend to behave similarly in terms of direction and magnitude, they correlate.</p>
<p>However, there is no reason to assume there is a causal relationship between ice cream sales and the number of crimes.</p>
<p><strong>Question:</strong> Describe the dependencies in the DAG above.</p>
<details><summary>
Answer
</summary><ul>
<li>
<span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span>: dependent, as indicated by arrow. Higher temperature leads to more ice cream sales.</li>
<li>
<span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by arrow. Higher temperature leads to more crimes.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: dependent, as both are influenced by <span class="math inline">\(Z\)</span>. <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> change both with variation in <span class="math inline">\(Z\)</span>. Variation in temperature affects ice cream sales and number of crimes simultaneously.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: independent, as for a fixed level of temperature, there is no association anymore.</li>
</ul></details><p><strong>Rule:</strong> <em>If variable</em> <span class="math inline">\(Z\)</span> <em>is a common cause of variables</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, and there is only one path between <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, then <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span><em>are independent conditional on X.</em></p>
<p>Again, we also check using R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y conditional on Z</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="collision" class="level3"><h3 class="anchored" data-anchor-id="collision">Collision</h3>
<p>The last mechanism is the collision, which is also called common effect.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Collider</span></span>
<span><span class="va">collider</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">Y</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">3</span>, Z <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">0</span>, X <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot DAG</span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">collider</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_dag_cds</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom theme, can be left out</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>It is the reflection of the fork and both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have a common effect on the collision node <span class="math inline">\(Z\)</span>.</p>
<p>This time, as we are already used to it, we will start to list the dependencies and then use an example for illustration:</p>
<ul>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by arrow.</li>
<li>
<span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by arrow.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: independent, there is no path between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</li>
<li>
<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: dependent.</li>
</ul>
<p>A popular way to illustrate the common effect, especially the last dependency, is to take an example that is related to Berkson’s paradox.</p>
<p>For example, imagine the variables to be:</p>
<ul>
<li>
<span class="math inline">\(X\)</span>: programming skills</li>
<li>
<span class="math inline">\(Y\)</span>: social skills</li>
<li>
<span class="math inline">\(Z\)</span>: hired by renowned tech company</li>
</ul>
<p>First of all, in the general population, there is no correlation between programming skills and social skills (3rd dependency). Second, having either programming or social skills will land you a job a a tech company (1st and 2nd dependency).</p>
<p>But what about the last dependency? Why are programming and social skills suddenly correlated when conditioned on e.g.&nbsp;being hired by a tech company? That is because when you know someone works for a tech company and has no programming skill, the likelihood that he/she has social skills increases because otherwise he/she would have likely not be hired. Vice versa, if you know someone has been hired and has no social skills, he/she is probably a talented programmer.</p>
<p><strong>Rule:</strong> <em>If a variable</em> <span class="math inline">\(Z\)</span> <em>is the collision node between two variables</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, and there is only one path between <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, then <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span> <em>are unconditionally independent but are dependent conditional on</em> <span class="math inline">\(Z\)</span> <em>(and any descendants of</em> <span class="math inline">\(Z\)</span>)<em>.</em></p>
<p>Same procedure as above, checking using R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check d-separation between X and Y conditional on Z</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="quiz" class="level3"><h3 class="anchored" data-anchor-id="quiz">Quiz</h3>
<ol type="1">
<li>Look at the following DAG and by hand, describe what nodes are d-separated and which ones are not.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create DAG from dagitty</span></span>
<span><span class="va">dag_model</span> <span class="op">&lt;-</span> <span class="st">'dag {</span></span>
<span><span class="st">bb="0,0,1,1"</span></span>
<span><span class="st">X [exposure,pos="0.075,0.4"]</span></span>
<span><span class="st">Y [outcome,pos="0.4,0.4"]</span></span>
<span><span class="st">M [pos="0.2,0.4"]</span></span>
<span><span class="st">Z1 [pos="0.2,0.2"]</span></span>
<span><span class="st">Z2 [pos="0.3,0.5"]</span></span>
<span><span class="st">Z3 [pos="0.2,0.6"]</span></span>
<span><span class="st">Z4 [pos="0.4,0.6"]</span></span>
<span><span class="st">X -&gt; M</span></span>
<span><span class="st">M -&gt; Y</span></span>
<span><span class="st">X -&gt; Z3</span></span>
<span><span class="st">Z1 -&gt; X</span></span>
<span><span class="st">Z1 -&gt; Y</span></span>
<span><span class="st">Z2 -&gt; Y</span></span>
<span><span class="st">Z2 -&gt; Z3</span></span>
<span><span class="st">Z3 -&gt; Z4</span></span>
<span><span class="st">}</span></span>
<span><span class="st">'</span></span>
<span><span class="co"># draw DAG</span></span>
<span><span class="fu">ggdag_status</span><span class="op">(</span><span class="va">dag_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Disable the legend</span></span>
<span>  <span class="fu">theme_dag_cds</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom theme, can be left out</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>For each of the following scenarios, explain <strong>whether the nodes <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are d-separated</strong>.</p>
<ul>
<li>no conditioning</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>conditioning on <span class="math inline">\((M, Z1)\)</span>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>conditioning on <span class="math inline">\((M, Z3)\)</span>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>conditioning on <span class="math inline">\((M, Z1, Z4)\)</span>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>conditioning on <span class="math inline">\((M, Z1, Z2, Z4)\)</span>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>In R, draw a DAG of a randomized controlled trial. Assume the following variables: the treatment <span class="math inline">\(D\)</span> and a variable <span class="math inline">\(Z\)</span> that affects the outcome <span class="math inline">\(Y\)</span>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># RCT</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="practical-examples" class="level2"><h2 class="anchored" data-anchor-id="practical-examples">Practical examples</h2>
<section id="effect-of-hiring-consultants" class="level3"><h3 class="anchored" data-anchor-id="effect-of-hiring-consultants">Effect of hiring consultants</h3>
<p>Consider this scenario: You aim to determine the effectiveness of hiring top consultants for your company and quantify this impact. You have access to a large company database containing profit data from both the previous and current years, along with information on whether companies have hired top consultants.</p>
<p>First, we are going to load the data (You’ll need to <a href="https://cloud.tuhh.de/index.php/s/tjmrD3XfewQQAdg">download</a> the data first).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>.rds</code> format is a specific R format preferred over other format like <code>.csv</code> when you are working only in R. It preserves R-specific attributes and structure and loads and saves objects efficiently with <code><a href="https://rdrr.io/r/base/readRDS.html">readRDS()</a></code> and <code><a href="https://rdrr.io/r/base/readRDS.html">saveRDS()</a></code>, respectively.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="va">profits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"profits.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">profits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 4
   company previous_profit consultant profit
     &lt;int&gt;           &lt;dbl&gt;      &lt;int&gt;  &lt;dbl&gt;
 1       1            7.46          1   7.44
 2       2            5.92          0   5.03
 3       3            7.47          1   7.32
 4       4            8.73          1   8.39
 5       5            6.65          0   5.75
 6       6            2.47          0   2.13
 7       7            4.59          0   4.06
 8       8            5.80          1   5.99
 9       9            5.83          1   5.9 
10      10            4.39          0   3.72
# ℹ 990 more rows</code></pre>
</div>
</div>
<section id="identification" class="level4"><h4 class="anchored" data-anchor-id="identification">Identification</h4>
<p>By now, you have learned that the first step in causal inference - before estimating the treatment effect - is the identification and in this chapter you have learned a useful graphical tool: DAGs. Let’s draw the DAG that shows your understanding of the scenario and find out how we are able to recover the causal effect of hiring consultants on profits.</p>
<p>Let’s discuss each possible dependency:</p>
<ul>
<li>
<span class="math inline">\(consultant\)</span> - <span class="math inline">\(profit\)</span>
</li>
<li>
<span class="math inline">\(consultant\)</span> - <span class="math inline">\(previous\_profit\)</span>
</li>
<li>
<span class="math inline">\(profit\)</span> - <span class="math inline">\(previous\_profit\)</span>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Construct DAG</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By now, you are probably already able to see it on a first glance because you know what a confounder is and how to adjust for it. But for the purpose of demonstration, let’s <code>dagitty</code> tell us what we need to adjust for.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Adjustment set</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, it is the backdoor adjustment which we need to perform in our estimation. We need to control for the previous profits because more previously profitable companies are more likely to hire top consultants and are more likely to make profits again.</p>
</section><section id="estimation" class="level4"><h4 class="anchored" data-anchor-id="estimation">Estimation</h4>
<p>In the lecture, you have learned the following formula to satisfy the backdoor criterion: condition on the values of your adjustment set and average over the joint distribution.</p>
<p><span class="math display">\[
P(Y|do(D)) = \sum\nolimits_W P(Y|D=d, W=w) P(W=w)
\]</span> We slightly rewrite the so-called <em>adjustment formula</em> to highlight what we need to do in the estimation step.</p>
<p><span class="math display">\[
\begin{align}
ATE &amp;= E_W[E(Y|D=1) - E(Y|D=0)] \\
ATE &amp;= \sum_{w \in W} [E(Y|D=1, W=w) - E(Y|D=0, W=w)] P(W=w) \\
&amp;= \sum_{w \in W} [E(Y|D=1, W=w)P(W=w) - E(Y|D=0, W=w)P(W=w)]
\end{align}
\]</span> When dealing with only a few values of <span class="math inline">\(W\)</span>, you condition by examining each group <span class="math inline">\(w \in W\)</span>, comparing treated and untreated observations within each group, and then averaging the outcomes, with the group sizes serving as weights. Remember, you assume that within the groups the treatment must look as if it was as good as randomly assigned.</p>
<p>However, when we look at our adjustment set, which is the previous profit of a company, we see that there are not only a couple of values, but theoretically, previous profits could take any real number.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> provides a concise summary of the statistical properties of data objects such as data frames, vectors or even models.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Statistical summary of column of previous profits</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following weeks, we will learn sophisticated methods to deal with continuous confounders, but today, we refer to a simpler method. We assign each company to a group determined by the value of previous profits. The function <code>ntile()</code> does the job: it splits the data into <span class="math inline">\(n\)</span> equally sized groups ordered by size.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, pipes <code>|&gt;</code> are used to chain together multiple operations in a readable and concise manner. The <code>|&gt;</code> operator (shortcut: <code>cmd/ctrl</code> + <code>shift</code> + <code>m</code>) passes the output of one function as the first argument to the next function. This makes code easier to understand by avoiding nested function calls and enhancing code readability.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, <code>group_by()</code> is used to group data by one or more variables, <code>summarise()</code> computes summary statistics within each group, and <code>ungroup()</code> removes grouping structure. These functions are commonly used together in data manipulation workflows and belong to the <code>tidyverse</code> (<code>dplyr</code>). <code>n()</code> is a function specifically for such grouping operations. It does not take any arguments and counts the number of rows in each group.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split group into n equally sized groups </span></span>
<span><span class="co"># ...</span></span>
<span></span>
<span><span class="co"># Compute mean value and number of observations by group</span></span>
<span><span class="co"># profits_by_group &lt;- profits |&gt;</span></span>
<span>  <span class="co"># What columns to group by</span></span>
<span>  <span class="co"># ...</span></span>
<span>  <span class="co"># What columns to use for aggregation and what kind of aggregations</span></span>
<span>  <span class="co"># ...</span></span>
<span>    <span class="co"># Average profit by group</span></span>
<span>    </span>
<span>    <span class="co"># Number of observations by group</span></span>
<span>  <span class="co"># Remove grouping structure</span></span>
<span>  </span>
<span></span>
<span><span class="co"># Show table</span></span>
<span><span class="co">#print(profits_by_group)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, <code>pivot_wider()</code> is a function included in the <code>tidyverse</code> (<code>tidyr</code>) used to convert data from long to wide format. It reshapes data by spreading values from a column into multiple columns, with each unique value in that column becoming a new column. This is particularly useful for creating summary tables or reshaping data for analysis and visualization.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>mutate()</code> in R’s <code>dplyr</code> (incl.&nbsp;in <code>tidyverse</code>) adds new columns to a data frame, allowing you to transform or calculate values based on existing columns.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convert to wide format to compute effect</span></span>
<span><span class="co"># te_by_group &lt;- profits_by_group |&gt; </span></span>
<span>  <span class="co"># Convert column values of consultant to headers and take values from</span></span>
<span>  <span class="co"># mean_profit</span></span>
<span>  <span class="co"># pivot_wider(</span></span>
<span>    <span class="co"># For each group, we want one row</span></span>
<span>    <span class="co"># id_cols = ,</span></span>
<span>    <span class="co"># Values of consultants to headers</span></span>
<span>    <span class="co"># names_from = , </span></span>
<span>    <span class="co"># Take values from 'mean_profit'</span></span>
<span>    <span class="co"># values_from = ,</span></span>
<span>    <span class="co"># Change names of headers for better readability</span></span>
<span>    <span class="co">#names_prefix = ,</span></span>
<span>    <span class="co">#) |&gt; </span></span>
<span>  <span class="co"># Compute group treatment effect by subtracting mean of untreated units from</span></span>
<span>  <span class="co"># mean of treated units</span></span>
<span>  <span class="co"># mutate()</span></span>
<span></span>
<span><span class="co"># Show table</span></span>
<span><span class="co">#print(te_by_group)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because all groups have the same size the weighted average is equal to the average and we can simply take the average to obtain the ATE:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Taking the average of the treatment effect column. Same as weighted mean,</span></span>
<span><span class="co"># because group sizes are identical.</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># With weighted mean</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One assumption that needs to be fulfilled for the treatment effect to be valid is the positivity assumption we discussed in the last week. Let’s recall it (slightly rewritten to match the notation of our example):</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Assumption 6: “Positivity / Overlap / Common Support”.</strong></p>
<p>For all values of covariates <span class="math inline">\(w\)</span> present in the population of interest (i.e.&nbsp;<span class="math inline">\(w\)</span> such that <span class="math inline">\(P(W=w) &gt; 0\)</span>), we have <span class="math inline">\(0 &lt; P(D=1|W=w) &lt; 1\)</span>.</p>
</div>
</div>
<p><strong>Question:</strong> Is the positivity assumption satisfied?</p>
<details><summary>
Answer
</summary><p>Yes, because in each group, we have observations from both groups. Take a look at the column <code>nobs</code> in the table <code>profits_by_group</code>.</p>
</details><p>For the sake of demonstration, let’s see what would have happened, had we not adjusted for the previous profits:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Naive estimate</span></span>
<span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="effect-of-new-feature" class="level3"><h3 class="anchored" data-anchor-id="effect-of-new-feature">Effect of new feature</h3>
<p>Imagine you’re at a software company, introducing a new feature and keen to gauge its impact. To ensure unbiased results, you conduct a randomized rollout: 10% of customers receive the new feature randomly, while the rest do not. Your aim is to assess if this feature enhances customer satisfaction, indirectly measured through Net Promoter Score (NPS). You distribute surveys to both the treated (with the new feature) and control groups, asking if they would recommend your product. Upon analysis, you observe higher NPS scores among customers with the new feature. But can you attribute this difference solely to the feature? To delve into this, start with a graph illustrating this scenario.</p>
<p><strong>Identification</strong></p>
<p>Graphically modeling the described scenario, you’ll end up with:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rollout_dag</span> <span class="op">&lt;-</span> <span class="st">'dag {</span></span>
<span><span class="st">bb="0,0,1,1"</span></span>
<span><span class="st">"Customer satisfaction" [pos="0, 1"]</span></span>
<span><span class="st">"New feature" [exposure,pos="0, 0"]</span></span>
<span><span class="st">NPS [outcome,pos="1,1"]</span></span>
<span><span class="st">Response [adjusted,pos=".8, 0"]</span></span>
<span><span class="st">"Customer satisfaction" -&gt; NPS</span></span>
<span><span class="st">"Customer satisfaction" -&gt; Response</span></span>
<span><span class="st">"New feature" -&gt; "Customer satisfaction"</span></span>
<span><span class="st">"New feature" -&gt; Response</span></span>
<span><span class="st">Response -&gt; NPS</span></span>
<span><span class="st">}'</span></span>
<span></span>
<span><span class="fu">ggdag</span><span class="op">(</span><span class="va">rollout_dag</span>, text <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_dag_cds</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># custom theme, can be left out</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_label_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="fu">ggthemr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemr/man/swatch.html">swatch</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="week_2_tut_1_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="week_2_tut_1_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Argue, what needs to be adjusted for to compute the effect of the new feature on the net promoter score (NPS).</p>
<!--
**Estimation:**

Because identification not possible, we cannot compute the effect.
-->
</section></section><section id="assignment" class="level2"><h2 class="anchored" data-anchor-id="assignment">Assignment</h2>
<div class="assignment">
<p>Accept the <a href="LINK"><strong>Week 2 - Assignment</strong></a> and follow the same steps as last week and as described in the organization chapter.</p>
<p>Solve the following assignments:</p>
<p>Coming soon.</p>
</div>
</section><section id="further-optional-reading" class="level2"><h2 class="anchored" data-anchor-id="further-optional-reading">Further optional reading</h2>
<p>In this chapter, we already used some functions from the <code>tidyverse</code>. Functions from the tidyverse, are often preferred over base R functions for several reasons:</p>
<ul>
<li><p>Readability and Expressiveness: Tidyverse functions use a consistent and expressive syntax, making code easier to read and write. This can enhance collaboration and reduce errors.</p></li>
<li><p>Piping: Tidyverse functions work well with the <code>|&gt;</code> pipe operator, allowing for a more fluid and readable data manipulation workflow.</p></li>
<li><p>Tidy Data Principles: Tidyverse functions are designed around the principles of tidy data, which promotes a standardized way of organizing data that facilitates analysis and visualization.</p></li>
</ul>
<p>For an overview of base R vs tidyverse functions, you can read <a href="https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html">here</a>.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>lv3095_s24: Causal Data Science for Business Analytics</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","descPosition":"bottom","loop":false,"closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>


</body></html>