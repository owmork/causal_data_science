<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-10-01">

<title>Causal Data Science for Business Analytics - Directed Acyclic Graphs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/toolbox/05_rct.html" rel="next">
<link href="../../content/fundamentals/03_caus.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Causal Data Science for Business Analytics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../content/index.html" aria-current="page">Content</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Directed Acyclic Graphs</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/index.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Fundamentals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/fundamentals/01_prob.html" class="sidebar-item-text sidebar-link">Probability Theory and Statistics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/fundamentals/02_reg.html" class="sidebar-item-text sidebar-link">Regression and Statistical Inference</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/fundamentals/03_caus.html" class="sidebar-item-text sidebar-link">Causal Inference</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/fundamentals/04_dag.html" class="sidebar-item-text sidebar-link active">Directed Acyclic Graphs</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Toolbox</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/toolbox/05_rct.html" class="sidebar-item-text sidebar-link">Randomized Controlled Trials</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/toolbox/06_match.html" class="sidebar-item-text sidebar-link">Matching and Subclassification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/toolbox/07_did.html" class="sidebar-item-text sidebar-link">Difference-in-Differences</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/toolbox/08_iv.html" class="sidebar-item-text sidebar-link">Instrumental Variables</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/toolbox/09_rdd.html" class="sidebar-item-text sidebar-link">Regression Discontinuity</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#three-types-of-association" id="toc-three-types-of-association" class="nav-link" data-scroll-target="#three-types-of-association">Three Types of Association</a>
  <ul class="collapse">
  <li><a href="#chain" id="toc-chain" class="nav-link" data-scroll-target="#chain">Chain</a></li>
  <li><a href="#fork" id="toc-fork" class="nav-link" data-scroll-target="#fork">Fork</a></li>
  <li><a href="#collision" id="toc-collision" class="nav-link" data-scroll-target="#collision">Collision</a></li>
  </ul></li>
  <li><a href="#causal-identification" id="toc-causal-identification" class="nav-link" data-scroll-target="#causal-identification">Causal Identification</a>
  <ul class="collapse">
  <li><a href="#confounding" id="toc-confounding" class="nav-link" data-scroll-target="#confounding">Confounding</a></li>
  <li><a href="#collider" id="toc-collider" class="nav-link" data-scroll-target="#collider">Collider</a></li>
  </ul></li>
  <li><a href="#simulating-interventions" id="toc-simulating-interventions" class="nav-link" data-scroll-target="#simulating-interventions">Simulating interventions</a>
  <ul class="collapse">
  <li><a href="#d-separation" id="toc-d-separation" class="nav-link" data-scroll-target="#d-separation">d-separation</a></li>
  <li><a href="#backdoorfrontdoor-criterion" id="toc-backdoorfrontdoor-criterion" class="nav-link" data-scroll-target="#backdoorfrontdoor-criterion">Backdoor/Frontdoor Criterion</a></li>
  <li><a href="#algorithms-to-identify-causally-valid-estimates" id="toc-algorithms-to-identify-causally-valid-estimates" class="nav-link" data-scroll-target="#algorithms-to-identify-causally-valid-estimates">Algorithms to identify causally valid estimates</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment">Assignment</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Directed Acyclic Graphs</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 1, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>We have already learned that correlation and causation can easily be confused. Now, we will define concepts and acquire tools that help us in developing credible identification strategies to separate correlation from causation. One essential part is <strong>graphically modeling your theoretical knowledge</strong> about the data-generating process.</p>
<p>In causal inference, <strong>directed acylic graphs</strong> (<strong>DAGs)</strong> do the graphic modeling part. They are the foundation of any analysis strategy and moreover communicate your research plan.</p>
<p>DAGs show what variables are important for your analysis and how you think they are related. Information to draw a DAG can come things like:</p>
<ul>
<li><p>Domain knowledge</p></li>
<li><p>State-of-the art theory</p></li>
<li><p>Plausible assumptions and hypotheses</p></li>
<li><p>Observations and experiences</p></li>
<li><p>Conversations with experts</p></li>
</ul>
<p>A DAG should map what you know about the phenomena you are studying into a visual representation. By deciding how to draw your graph you have to ask yourself:</p>
<ul>
<li><p>Between what variables do you think is <strong>a causal relationship</strong>?</p></li>
<li><p>Between what variables there is <strong>no causal relationship</strong>?</p></li>
</ul>
<p>Besides being helpful in guiding your analysis and identification strategy, DAGs also show your research design to your audience.</p>
<p>A simple example of a DAG could be the effect of having an university degree on future salary: at first, it might be intuitive to say that future salary increases when you get an university degree.</p>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<p>But zooming out and thinking about why a university degree is correlated with higher salaries could lead you to the idea that both university degree and salary are influenced by individuals’ ability. People who are more capable tend to go to university and will be more successful in their later career regardless of the university degree.</p>
<p>It is very likely that the truth is that both ability and university degree are factors for future salary, but just to get your assumptions clear and guide you in your research strategy, DAGs are of a great benefit.</p>
</section>
<section id="notation" class="level1">
<h1>Notation</h1>
<p>Let’s have a look at a generic DAG to dive into the notation.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>First of all, a DAG presents a chain of causal effects captured by nodes and arrows. <strong>Nodes depict random variables</strong>, such as the treatment variable, control variables and the outcome variable and <strong>arrows represent the flow of a causal effect</strong> between two variables.</p>
<p>In a <u><strong>directed</strong></u> acyclic graph, causal relationships run in one direction and they run forward in time. The direction is represented by an arrow: there is a an effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> and there is an effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p>
<p>Also, directed <u><strong>acylic</strong></u> graphs are only useful in scenarios where the flow of causation runs in one direction. Graphs do no involve things as reverse causality or simultaneity. (Then, you could help yourself using time indices for the variables, but in general DAGs are used only for acyclic models.)</p>
<p>Nodes are ancestors or parents of another node when there is an arrow directing from the parent node to the child node: <span class="math inline">\(Z\)</span> is the parent node of its child node <span class="math inline">\(X\)</span> and so on. Instead of child node, you can also use the term descendant.</p>
</section>
<section id="three-types-of-association" class="level1">
<h1>Three Types of Association</h1>
<p>Most of the time, DAGs are more complex than the example above. Even in that example, there are many more variables that could be included, like social environment, gender etc. But although in practice DAGs are more complex, they can be disassembled in building blocks that are easier to analyze.</p>
<p>Effectively, there are only three different types of association we need to focus on:</p>
<ol type="1">
<li><p><strong>Chain</strong>: <span class="math inline">\(X \rightarrow Z \rightarrow Y\)</span></p></li>
<li><p><strong>Confounder</strong>: <span class="math inline">\(X \leftarrow Z \rightarrow Y\)</span></p></li>
<li><p><strong>Collider</strong>: <span class="math inline">\(X \rightarrow Z \leftarrow Y\)</span></p></li>
</ol>
<p>Knowing their characteristics and idiosyncrasies allows us to identify valid strategies to estimate causal effects. Then, you know which variables you have to include in your analysis and which ones you have to leave out. Because in case you include or exclude the wrong variables, you will end up with a biased results and you are not able to interpret your estimate causally.</p>
<p>It is important to understand (conditional) (in-)dependencies between <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span> with particular focus on <strong>conditional independence</strong>. What it exactly is, how it is defined, we will explain now going through the types of association mentioned above.</p>
<section id="chain" class="level2">
<h2 class="anchored" data-anchor-id="chain">Chain</h2>
<p>One element is a chain of random variables where the causal effect flows in one direction.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>An example of such a causal mechanism (page 37, Pearl) could be the effect of work hours on training and training on race time. In the DAG, the variables would be:</p>
<ul>
<li><p><span class="math inline">\(X\)</span>: work hours</p></li>
<li><p><span class="math inline">\(Z\)</span>: training</p></li>
<li><p><span class="math inline">\(Y\)</span>: race time</p></li>
</ul>
<p>This mechanism is also sometimes called mediation, because <span class="math inline">\(Z\)</span> mediates the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p>
<p>In terms of dependencies,</p>
<ul>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by the arrow.</p></li>
<li><p><span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by the arrow.</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by the arrow (going through <span class="math inline">\(Z\)</span>).</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: independent, because when we condition on the training amount, that means we hold training amount fixed at a particular level, then there is no effect from work hours to race time as there is no direct effect, but only an effect through the amount of training. In other words, for individuals that differ in the hours they work but still have the same amount of training, there is no association between working hours and race time.</p></li>
</ul>
<p><strong>Rule:</strong> <em>Two variables,</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span><em>, are conditionally independent given</em> <span class="math inline">\(Z\)</span><em>, if there is only one unidirectional path between</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span> <em>and</em> <span class="math inline">\(Z\)</span> <em>is any set of variables that intercepts that path.</em></p>
</section>
<section id="fork" class="level2">
<h2 class="anchored" data-anchor-id="fork">Fork</h2>
<p>Another mechanism is the fork, also called common cause.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>The reason it is called common cause is that, as depicted above, both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are caused by <span class="math inline">\(Z\)</span>.</p>
<p>To illustrate it, consider the following scenario: <span class="math inline">\(Z\)</span> represents the temperature in a particular town and <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> represent ice cream sales and number of crimes in that same town, respectively.</p>
<p>Then, you could hypothesize that with increasing temperature people start to eat and buy more ice cream and also more crimes will happen as more people are outside which presents a greater opportunity for crime. Therefore ice cream sales and number of crimes tend to behave similarly in terms of direction and magnitude, they correlate.</p>
<p>However, there is no reason to assume there is a causal relationship between ice cream sales and the number of crimes.</p>
<p>Again, let’s check in term of dependencies:</p>
<ul>
<li><p><span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span>: dependent, as indicated by arrow.</p></li>
<li><p><span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>: dependent, as indicated by arrow.</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: dependent, as both are influenced by <span class="math inline">\(Z\)</span>. <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> change both with variation in <span class="math inline">\(Z\)</span>.</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: independent, as for a fixed level of temperature, there is no association anymore.</p></li>
</ul>
<p><strong>Rule:</strong> <em>If variable</em> <span class="math inline">\(Z\)</span> <em>is a common cause of variables</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, and there is only one path between <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, then <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span><em>are independent conditional on X.</em></p>
</section>
<section id="collision" class="level2">
<h2 class="anchored" data-anchor-id="collision">Collision</h2>
<p>The last mechanism is the collision, which is also called common effect.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>It is the reflection of the fork and both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have a common effect on the collision node <span class="math inline">\(Z\)</span>.</p>
<p>This time, as we are already used to it, we will start to list the dependencies and then use an example for illustration:</p>
<ul>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by arrow.</p></li>
<li><p><span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span>: dependent, as indicated by arrow.</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>: independent, there is no path between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p></li>
<li><p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> conditional on <span class="math inline">\(Z\)</span>: dependent.</p></li>
</ul>
<p>A popular way to illustrate the common effect, especially the last dependency, is to take an example that is related to Berkson’s paradox.</p>
<p>For example, imagine the variables to be:</p>
<ul>
<li><p><span class="math inline">\(X\)</span>: attractiveness</p></li>
<li><p><span class="math inline">\(Y\)</span>: talent</p></li>
<li><p><span class="math inline">\(Z\)</span>: celebrity</p></li>
</ul>
<p>First of all, in the general population, there is no correlation between attractiveness and talent (3rd dependency). Second, being either attractive or having a talent will help you to become a celebrity (1st and 2nd dependency).</p>
<p>But what about the last dependency? Why are attractiveness and talent suddenly correlated when conditioned on e.g.&nbsp;being a celebrity? That is because when you know someone is a celebrity and has no talent, the likelihood that he/she is attractive increases because otherwise he/she would likely not be a celebrity. Vice versa, if you know someone is a celebrity and is not attractive, he/she is probably talented in some form.</p>
<p><strong>Rule:</strong> <em>If a variable</em> <span class="math inline">\(Z\)</span> <em>is the collision node between two variables</em> <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, and there is only one path between <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span>, then <span class="math inline">\(X\)</span> <em>and</em> <span class="math inline">\(Y\)</span> <em>are unconditionally independent but are dependent conditional on</em> <span class="math inline">\(Z\)</span> <em>(and any descendants of</em> <span class="math inline">\(Z\)</span>)<em>.</em></p>
</section>
</section>
<section id="causal-identification" class="level1">
<h1>Causal Identification</h1>
<p>You might wonder why we put such an emphasis on the dependencies in the previous sections. In fact, to isolate causal effects it is crucial to know how to interpret DAGs based on the dependence structure. Understanding what paths between what variables can bias effects is maybe the most important concept of causal inference.</p>
<p>Again, to understand the theory we will rely on simple examples and you will see a lot of similarities to the section above.</p>
<section id="confounding" class="level2">
<h2 class="anchored" data-anchor-id="confounding">Confounding</h2>
<p>A very common problem when trying to prove causal effects is confounding.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>It is the same DAG as in the introduction. So just recall and imagine <span class="math inline">\(X\)</span> was university degree, <span class="math inline">\(Y\)</span> future salary and <span class="math inline">\(Z\)</span> ability.</p>
<p>There are two paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>:</p>
<ol type="1">
<li><p><strong>direct</strong> path <span class="math inline">\(X \rightarrow Y\)</span></p></li>
<li><p><strong>backdoor</strong> path <span class="math inline">\(X \leftarrow Z \rightarrow Y\)</span></p></li>
</ol>
<p>First of all, it is important to clarify what effect we are actually <strong>interested in</strong> and that is the <strong>direct causal effect</strong> of university degree on future salary, <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p>
<p>The <strong>indirect effect</strong> is not causal but is only <strong>spurious correlation</strong> induced by <span class="math inline">\(Z\)</span> which we are generally not interested in. It is called <em>backdoor path.</em></p>
<p>So how do we proceed to extract that effect? We need to somehow remove the association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> that is only due to variation in <span class="math inline">\(Z\)</span>. And from the previous section we know how to do that. <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> need to be <strong>independent conditional</strong> on <span class="math inline">\(Z\)</span> and <strong>block the path</strong> from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span> over <span class="math inline">\(Z\)</span>.</p>
<p>But what does blocking the path mean? It means that we have to condition on <span class="math inline">\(Z\)</span>, to keep it at a fixed level. Then, the variations in <span class="math inline">\(X\)</span> that cause <span class="math inline">\(Y\)</span> to vary are not due to <span class="math inline">\(Z\)</span> because it does not vary at all and cannot have an impact on either <span class="math inline">\(X\)</span> or <span class="math inline">\(Y\)</span>. Doing that we <strong>closed the backdoor</strong> and are able to retrieve the causal effect.</p>
<p>Not blocking the path would falsify our results and is what is called the omitted variable bias. That is why <span class="math inline">\(Z\)</span> is called <strong>confounder</strong>, because it <strong>confounds the ability to measure the causal effect</strong>.</p>
<p>However, the main problem is that in many cases you might not be able to block the path for two different reasons:</p>
<ul>
<li><p>You are aware of the confounder, but you did not collect data for it</p></li>
<li><p>You are not aware of the confounder (and probably did not collect data for it)</p></li>
</ul>
<p>This stresses the importance of theoretical knowledge about the phenomenon you are researching. Without it, it is very unlikely that you can prove truly causal effects. The risk of not paying attention to confounders gets clear when we look at graphs visualizing an example of Simpson’s paradox: accounting for a third variable reverses the sign of correlation.</p>
<p>We can illustrate it with an imaginary example. Let’s assume you want to measure how a specific characteristic affects salary. So you start to collect data about both variables, throw them into a regression and your result tells you that there is a positive correlation. But what happens if you take the education level into account? You can see how the lines show a positive correlation on the left and a negative correlation on the right. When you include a third variable, the relationship reverses.</p>
<p>It is neither wrong or right to always include or exclude variables, but it depends on the application and question you want to answer. This is why causal reasoning is so important.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simpson's paradox ----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e+03</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">2</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>character <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n) <span class="sc">+</span> education</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> education <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n) <span class="sc">-</span> character <span class="sc">*</span> <span class="fl">0.3</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">10000</span><span class="sc">:</span><span class="dv">11000</span>,<span class="dv">1</span>) <span class="sc">+</span> scales<span class="sc">::</span><span class="fu">rescale</span>(salary, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>character <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">rescale</span>(character, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">factor</span>(education, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  salary,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  character,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  education</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Not conditioning on education</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>simps_not_cond <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> character, <span class="at">y =</span> salary)) <span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditioning on education  </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>simps_cond <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> character, <span class="at">y =</span> salary, <span class="at">color =</span> education)) <span class="sc">+</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both plots</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>simps_not_cond</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>simps_cond</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="collider" class="level2">
<h2 class="anchored" data-anchor-id="collider">Collider</h2>
<p>You probably noticed that the confounding example was related to the common cause in the previous section. The next example is related to the common effect mechanism.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now consider the following example: a research group wants to examine if there is a causal relationship between grade point averages (<span class="math inline">\(X\)</span>) and musical talent (<span class="math inline">\(Y\)</span>). They can use data from their own university where both is measured for every student as scoring high in one of these characteristics substantially increases your chance of being accepted.</p>
<p>Now the researchers, who hypothesized a positive or no correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, perform a simple analysis and, to their surprise, find out that there is a strong negative correlation. This strange result can be explained by collider bias. Implicitly, as they only used data from their own university students, they also conditioned on a collider <span class="math inline">\(Z\)</span>, which is “accepted to university” and is fixed on a constant level of actually being accepted to the university.</p>
<p>Again, we have two paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>, but one thing is different: the <strong>backdoor path is already closed</strong> because <span class="math inline">\(Z\)</span> is a collider, both arrows point toward it.</p>
<p>To correct their results they would need to have data from the whole population and not only students from a university that puts focus on either grade point averages or musical talent. Having a full population as a sample would probably lead to the result that there is no correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>This case (collider) is different to the case before (confounding), where conditioning was the correct solution. But <strong>if you have a collider in you DAG, make sure not to condition on it</strong> as it creates a dependence between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. You “open” a backdoor path that was closed before, just due to the presence of the collider.</p>
<p>Collider bias often arises when your sample is not very representative of the population you are making claims about. How that could change your result can be seen in an example Berkson’s paradox. While there is no correlation for the whole population, for smaller subgroups there are. And therefore, it is crucial that you clearly state what effect you are interested in.</p>
<div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Berkson's paradox ----</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e+03</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ability     <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>motivation  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>aptitude    <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> ability <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> motivation <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, .<span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ability    =</span> ability,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">motivation =</span> motivation,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">aptitude   =</span> aptitude,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">student    =</span> <span class="fu">ifelse</span>(aptitude <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"student"</span>, <span class="st">"no_student"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Not conditioning on student</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>berk_not_cond <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> motivation, <span class="at">y =</span> ability)) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditioning on student  </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>berk_cond <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> motivation, <span class="at">y =</span> ability,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> student, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                            <span class="at">alpha =</span> student)) <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"student"</span> <span class="ot">=</span> ggthemr<span class="sc">::</span><span class="fu">swatch</span>()[<span class="dv">4</span>],</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"no_student"</span> <span class="ot">=</span> ggthemr<span class="sc">::</span><span class="fu">swatch</span>()[<span class="dv">5</span>])) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"student"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"no_student"</span> <span class="ot">=</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>berk_not_cond</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>berk_cond</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="simulating-interventions" class="level1">
<h1>Simulating interventions</h1>
<p>As you could see in the previous sections, DAGs help us to find out, in a non-technical but graphical way, how we are able to isolate the causal estimate we are interested in. And not explicitly stating our understanding of the data-generating process can easily lead us to wrong conclusions.</p>
<section id="d-separation" class="level2">
<h2 class="anchored" data-anchor-id="d-separation">d-separation</h2>
<p>One concept, that we have not named yet but implicitly used, is <strong>d-separation</strong>. If an effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> is d-separated, there is no statistical association that can flow between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> except for the direct effect. In fact, d-separation determines conditional independence.</p>
<p>D-separation formalizes what we have already learned when going through the tree types of association.</p>
<p>Practically (<a href="http://bayes.cs.ucla.edu/BOOK-2K/d-sep.html" class="uri">http://bayes.cs.ucla.edu/BOOK-2K/d-sep.html</a>) , it is easier to define the opposite, <strong>d-connection</strong>:</p>
<ul>
<li><p><strong>Rule 1:</strong> unconditional separation: <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are d-connected if there is an unblocked path between them. (As an example, imagine a confounder, that is not conditioned on.)</p></li>
<li><p><strong>Rule 2:</strong> blocking by conditioning: <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are d-connected, conditioned on a set of <span class="math inline">\(Z\)</span> nodes, if there is a collider-free path between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> that traverses no member. (Think of a mediated effect that takes away parts from the direct effect.)</p></li>
<li><p><strong>Rule 3</strong>: conditioning on colliders: If a collider is a member of conditioning set <span class="math inline">\(Z\)</span>, or has a descendant in <span class="math inline">\(Z\)</span>, then it no longer blocks any path that traces this collider. (Image the collider example in the previous section.)</p></li>
</ul>
<p>!!! MAYBE CHANGE TO <a href="https://de.wikipedia.org/wiki/D-Separation#:~:text=d%2DSeparation%20ist%20ein%20Begriff,die%20Separation%20in%20ungerichteten%20Graphen.">https://de.wikipedia.org/wiki/D-Separation</a></p>
<p>Knowing these rules and having mapped our assumptions into the DAG allows us to treat observational data like experimental data and simulate interventions as we would have conducted an experiment. However, it is not a silver bullet as in many cases data availability will stop you from isolating the causal effect. For example, if you do not observer a confounder, you cannot control for it. All empirical work requires theory and with observational data we need to be extra careful to make sure to actually extract the effects we are interested in.</p>
</section>
<section id="backdoorfrontdoor-criterion" class="level2">
<h2 class="anchored" data-anchor-id="backdoorfrontdoor-criterion">Backdoor/Frontdoor Criterion</h2>
<p>Special cases that are derived from d-separation rules are the backdoor and frontdoor criterion/adjustment.</p>
<p>To satisfy the backdoor criterion, we have to make sure all backdoors are closed, which, as already mentioned, differs for confounders and colliders.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/04_conf_coll_bias.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Again, we want to block all other paths between <span class="math inline">\(X\)</span> (treatment) and <span class="math inline">\(Y\)</span> (outcome). So depending on the structure of the DAG, the following can block a path:</p>
<ul>
<li><p>a chain or a fork whose middle <strong>node is in</strong> <span class="math inline">\(Z\)</span></p></li>
<li><p>a <strong>collider</strong> that is not conditioned on, which means it is <strong>not in</strong> <span class="math inline">\(Z\)</span></p></li>
</ul>
<p>The frontdoor criterion, which is actually a consecutive application of the backdoor criterion, is a bit more complicated and we will leave it out for now, but in a the section about instrumental variables we will deal with it extensively.</p>
</section>
<section id="algorithms-to-identify-causally-valid-estimates" class="level2">
<h2 class="anchored" data-anchor-id="algorithms-to-identify-causally-valid-estimates">Algorithms to identify causally valid estimates</h2>
<p>If DAGs become more complex because there are a lot of variables that are somehow related, we can make use of algorithms to check all the rules for us.</p>
<p>One application to help in such cases is <a href="http://dagitty.net/dags.html#" class="uri">http://</a><a href="http://dagitty.net/dags.html#" class="uri" title="dagitty">dagitty</a><a href="http://dagitty.net/dags.html#" class="uri">.net/dags.html</a>, where you can draw your DAG, define what is the treatment and outcome, which variables are observed and unobserved and many other things. Then it will show you what kind of adjustment is necessary to estimate the causal effect of interest.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/04_dagitty_example.png" class="img-fluid figure-img" width="350"></p>
</figure>
</div>
<p><strong>Try to build this graph on dagitty.net and look what useful information you can get from the site.</strong></p>
<p><code>dagitty</code> is also implemented in R and combined with <code>ggdag</code> you are also able to plot your DAGs in a easy manner and obtain information needed for designing your research.</p>
<p>First, let’s just plot the DAG. When we define exposure, which is a different term for intervention or treatment, and the outcome, they are highlighted in another color.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create DAG from dagitty</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dag_model <span class="ot">&lt;-</span> <span class="st">'dag {</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">bb="0,0,1,1"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">D [exposure,pos="0.075,0.4"]</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">Y [outcome,pos="0.4,0.4"]</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">Z1 [pos="0.2,0.2"]</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">Z2 [pos="0.3,0.5"]</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">Z3 [pos="0.2,0.6"]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">Z4 [pos="0.4,0.6"]</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">D -&gt; Y</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">D -&gt; Z3</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="st">Z1 -&gt; D</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="st">Z1 -&gt; Y</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="st">Z2 -&gt; Y</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="st">Z2 -&gt; Z3</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="st">Z3 -&gt; Z4</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># draw DAG</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_status</span>(dag_model) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span>  <span class="co"># Disable the legend</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag_cds</span>() <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Let’s check what paths there are from treatment <span class="math inline">\(D\)</span> to <span class="math inline">\(Y\)</span>. Of course, there is a direct path (the causal path) and there are two other paths, of which one is closed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find all paths</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paths</span>(dag_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$paths
[1] "D -&gt; Y"             "D -&gt; Z3 &lt;- Z2 -&gt; Y" "D &lt;- Z1 -&gt; Y"      

$open
[1]  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<p>We can also plot the open paths. One path is already blocked by a collider (remember: we do not want to open that path).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot paths</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_paths</span>(dag_model) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag_cds</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>To see what we have to adjust for to isolate the causal effect, we use <code>adjustmentsSets()</code>. As you might have figured out already, it is <span class="math inline">\(Z1\)</span> that needs to be conditioned on.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find all nodes that need to be adjusted</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(dag_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Z1 }</code></pre>
</div>
</div>
<p>A very concise summary plot is returned by the function <code>ggdag_adjustment_set()</code>, which shows what needs to be adjusted, the open paths and the whole DAG.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot adjustment sets</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_adjustment_set</span>(dag_model, <span class="at">shadow =</span> T) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag_cds</span>() <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_color =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="04_dag_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>But what does it actually mean in practice? How do we block a path or condition on a variable?</p>
<p>If you use a linear regression, including a variable as an independent variable is the sames as conditioning on it. If you use other models, you might have to use subsets and average them or do some kind of matching where you only compare units that have the same value for the variables that has to be conditioned on.</p>
<p>In the following chapters, we will deal with a large variety of techniques and figure out clever ways to isolate causal effects.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>We have learned that when we want to talk about causality, atheoretical approaches are likely to fail and assumptions have to be made and shown. DAGs are very powerful in depicting the relationships according to our theory and help to develop a valid research design.</p>
<p>Implicitly, DAGs always base on some form of counterfactual reasoning as we presuppose that we could change the values for the treatment variable by simulating an intervention. In that sense, DAGs give an answer to the fundamental problem of causal inference.</p>
</section>
<section id="assignment" class="level1">
<h1>Assignment</h1>
<ol type="1">
<li><p>Think about example from previous chapter (parking spots) and draw DAG</p></li>
<li><p>Load the data and compute what the click-through-rate (CTR, clicks / impressions) is for male and female. Then, compute the CTR for male and female on country level. Then, check what is surprising about the CTRs and explain how that could happen.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/fundamentals/03_caus.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Causal Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/toolbox/05_rct.html" class="pagination-link">
        <span class="nav-page-text">Randomized Controlled Trials</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>